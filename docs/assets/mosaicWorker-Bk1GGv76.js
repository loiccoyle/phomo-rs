(async()=>{var F="/assets/phomo_wasm_bg-C0lyUJ7D.wasm",R=async(e={},t)=>{let n;if(t.startsWith("data:")){const _=t.replace(/^data:.*?base64,/,"");let i;if(typeof Buffer=="function"&&typeof Buffer.from=="function")i=Buffer.from(_,"base64");else if(typeof atob=="function"){const c=atob(_);i=new Uint8Array(c.length);for(let s=0;s<c.length;s++)i[s]=c.charCodeAt(s)}else throw new Error("Cannot decode base64-encoded data URL");n=await WebAssembly.instantiate(i,e)}else{const _=await fetch(t),i=_.headers.get("Content-Type")||"";if("instantiateStreaming"in WebAssembly&&i.startsWith("application/wasm"))n=await WebAssembly.instantiateStreaming(_,e);else{const c=await _.arrayBuffer();n=await WebAssembly.instantiate(c,e)}}return n.instance.exports};let o;function $(e){o=e}const p=new Array(128).fill(void 0);p.push(void 0,null,!0,!1);function r(e){return p[e]}let k=p.length;function g(e){k===p.length&&p.push(p.length+1);const t=k;return k=p[t],p[t]=e,t}function E(e,t){try{return e.apply(this,t)}catch(n){o.__wbindgen_export_0(g(n))}}const V=typeof TextDecoder>"u"?(0,module.require)("util").TextDecoder:TextDecoder;let O=new V("utf-8",{ignoreBOM:!0,fatal:!0});O.decode();let B=null;function A(){return(B===null||B.byteLength===0)&&(B=new Uint8Array(o.memory.buffer)),B}function v(e,t){return e=e>>>0,O.decode(A().subarray(e,e+t))}function C(e){e<132||(p[e]=k,k=e)}function w(e){const t=r(e);return C(e),t}let y=0;const G=typeof TextEncoder>"u"?(0,module.require)("util").TextEncoder:TextEncoder;let S=new G("utf-8");const J=typeof S.encodeInto=="function"?function(e,t){return S.encodeInto(e,t)}:function(e,t){const n=S.encode(e);return t.set(n),{read:e.length,written:n.length}};function q(e,t,n){if(n===void 0){const b=S.encode(e),d=t(b.length,1)>>>0;return A().subarray(d,d+b.length).set(b),y=b.length,d}let _=e.length,i=t(_,1)>>>0;const c=A();let s=0;for(;s<_;s++){const b=e.charCodeAt(s);if(b>127)break;c[i+s]=b}if(s!==_){s!==0&&(e=e.slice(s)),i=n(i,_,_=s+e.length*3,1)>>>0;const b=A().subarray(i+s,i+_),d=J(e,b);s+=d.written,i=n(i,_,s,1)>>>0}return y=s,i}let x=null;function a(){return(x===null||x.buffer.detached===!0||x.buffer.detached===void 0&&x.buffer!==o.memory.buffer)&&(x=new DataView(o.memory.buffer)),x}function I(e){return e==null}function U(e){const t=typeof e;if(t=="number"||t=="boolean"||e==null)return`${e}`;if(t=="string")return`"${e}"`;if(t=="symbol"){const i=e.description;return i==null?"Symbol":`Symbol(${i})`}if(t=="function"){const i=e.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(e)){const i=e.length;let c="[";i>0&&(c+=U(e[0]));for(let s=1;s<i;s++)c+=", "+U(e[s]);return c+="]",c}const n=/\[object ([^\]]+)\]/.exec(toString.call(e));let _;if(n&&n.length>1)_=n[1];else return toString.call(e);if(_=="Object")try{return"Object("+JSON.stringify(e)+")"}catch{return"Object"}return e instanceof Error?`${e.name}: ${e.message}
${e.stack}`:_}function H(e,t){const n=t(e.length*1,1)>>>0;return A().set(e,n/1),y=e.length,n}let M=null;function P(){return(M===null||M.byteLength===0)&&(M=new Uint32Array(o.memory.buffer)),M}function K(e,t){const n=t(e.length*4,4)>>>0;return P().set(e,n/4),y=e.length,n}function Q(e,t){e=e>>>0;const n=a(),_=[];for(let i=e;i<e+4*t;i+=4)_.push(w(n.getUint32(i,!0)));return _}const X=Object.freeze({NormL1:0,0:"NormL1",NormL2:1,1:"NormL2"}),z=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>o.__wbg_mosaic_free(e>>>0,1));class Y{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,z.unregister(this),t}free(){const t=this.__destroy_into_raw();o.__wbg_mosaic_free(t,0)}constructor(t,n,_,i,c,s,b){try{const T=o.__wbindgen_add_to_stack_pointer(-16),W=H(t,o.__wbindgen_export_2),D=y;var d=I(b)?0:K(b,o.__wbindgen_export_2),f=y;o.mosaic_new(T,W,D,g(n),_,i,c,I(s)?2:s,d,f);var u=a().getInt32(T+4*0,!0),m=a().getInt32(T+4*1,!0),h=a().getInt32(T+4*2,!0);if(h)throw w(m);return this.__wbg_ptr=u>>>0,z.register(this,this.__wbg_ptr,this),this}finally{o.__wbindgen_add_to_stack_pointer(16)}}equalize(){o.mosaic_equalize(this.__wbg_ptr)}transferMasterToTiles(){o.mosaic_transferMasterToTiles(this.__wbg_ptr)}transferTilesToMaster(){try{const _=o.__wbindgen_add_to_stack_pointer(-16);o.mosaic_transferTilesToMaster(_,this.__wbg_ptr);var t=a().getInt32(_+4*0,!0),n=a().getInt32(_+4*1,!0);if(n)throw w(t)}finally{o.__wbindgen_add_to_stack_pointer(16)}}build(t){let n,_;try{const u=o.__wbindgen_add_to_stack_pointer(-16);o.mosaic_build(u,this.__wbg_ptr,t);var i=a().getInt32(u+4*0,!0),c=a().getInt32(u+4*1,!0),s=a().getInt32(u+4*2,!0),b=a().getInt32(u+4*3,!0),d=i,f=c;if(b)throw d=0,f=0,w(s);return n=d,_=f,v(d,f)}finally{o.__wbindgen_add_to_stack_pointer(16),o.__wbindgen_export_1(n,_,1)}}buildWithSolver(t,n){let _,i;try{const m=o.__wbindgen_add_to_stack_pointer(-16);o.mosaic_buildWithSolver(m,this.__wbg_ptr,t,n);var c=a().getInt32(m+4*0,!0),s=a().getInt32(m+4*1,!0),b=a().getInt32(m+4*2,!0),d=a().getInt32(m+4*3,!0),f=c,u=s;if(d)throw f=0,u=0,w(b);return _=f,i=u,v(f,u)}finally{o.__wbindgen_add_to_stack_pointer(16),o.__wbindgen_export_1(_,i,1)}}getTiles(){try{const s=o.__wbindgen_add_to_stack_pointer(-16);o.mosaic_getTiles(s,this.__wbg_ptr);var t=a().getInt32(s+4*0,!0),n=a().getInt32(s+4*1,!0),_=a().getInt32(s+4*2,!0),i=a().getInt32(s+4*3,!0);if(i)throw w(_);var c=Q(t,n).slice();return o.__wbindgen_export_1(t,n*4,4),c}finally{o.__wbindgen_add_to_stack_pointer(16)}}getMaster(){let t,n;try{const f=o.__wbindgen_add_to_stack_pointer(-16);o.mosaic_getMaster(f,this.__wbg_ptr);var _=a().getInt32(f+4*0,!0),i=a().getInt32(f+4*1,!0),c=a().getInt32(f+4*2,!0),s=a().getInt32(f+4*3,!0),b=_,d=i;if(s)throw b=0,d=0,w(c);return t=b,n=d,v(b,d)}finally{o.__wbindgen_add_to_stack_pointer(16),o.__wbindgen_export_1(t,n,1)}}buildBlueprint(t){try{const c=o.__wbindgen_add_to_stack_pointer(-16);o.mosaic_buildBlueprint(c,this.__wbg_ptr,t);var n=a().getInt32(c+4*0,!0),_=a().getInt32(c+4*1,!0),i=a().getInt32(c+4*2,!0);if(i)throw w(_);return w(n)}finally{o.__wbindgen_add_to_stack_pointer(16)}}buildBlueprintWithSolver(t,n){try{const s=o.__wbindgen_add_to_stack_pointer(-16);o.mosaic_buildBlueprintWithSolver(s,this.__wbg_ptr,t,n);var _=a().getInt32(s+4*0,!0),i=a().getInt32(s+4*1,!0),c=a().getInt32(s+4*2,!0);if(c)throw w(i);return w(_)}finally{o.__wbindgen_add_to_stack_pointer(16)}}renderBlueprint(t){let n,_;try{const u=o.__wbindgen_add_to_stack_pointer(-16);o.mosaic_renderBlueprint(u,this.__wbg_ptr,g(t));var i=a().getInt32(u+4*0,!0),c=a().getInt32(u+4*1,!0),s=a().getInt32(u+4*2,!0),b=a().getInt32(u+4*3,!0),d=i,f=c;if(b)throw d=0,f=0,w(s);return n=d,_=f,v(d,f)}finally{o.__wbindgen_add_to_stack_pointer(16),o.__wbindgen_export_1(n,_,1)}}}function Z(e){const t=r(e).buffer;return g(t)}function ee(){return E(function(e,t){const n=r(e).call(r(t));return g(n)},arguments)}function te(e,t,n,_){console.debug(r(e),r(t),r(n),r(_))}function ne(e){return r(e).done}function _e(e){console.error(r(e))}function re(e,t){let n,_;try{n=e,_=t,console.error(v(e,t))}finally{o.__wbindgen_export_1(n,_,1)}}function ie(e,t,n,_){console.error(r(e),r(t),r(n),r(_))}function oe(){return E(function(e,t){const n=Reflect.get(r(e),r(t));return g(n)},arguments)}function se(e,t){const n=r(e)[t>>>0];return g(n)}function ae(e,t){const n=r(e)[r(t)];return g(n)}function ce(e,t,n,_){console.info(r(e),r(t),r(n),r(_))}function be(e){let t;try{t=r(e) instanceof ArrayBuffer}catch{t=!1}return t}function ue(e){let t;try{t=r(e) instanceof Uint8Array}catch{t=!1}return t}function de(e){return Array.isArray(r(e))}function fe(e){return Number.isSafeInteger(r(e))}function ge(){return g(Symbol.iterator)}function le(e){return r(e).length}function we(e){return r(e).length}function me(e,t,n,_){console.log(r(e),r(t),r(n),r(_))}function pe(){const e=new Object;return g(e)}function ye(){const e=new Array;return g(e)}function he(){const e=new Error;return g(e)}function ve(e){const t=new Uint8Array(r(e));return g(t)}function Te(e){const t=r(e).next;return g(t)}function Ie(){return E(function(e){const t=r(e).next();return g(t)},arguments)}function xe(e,t,n){r(e)[t>>>0]=w(n)}function ke(e,t,n){r(e)[w(t)]=w(n)}function Ae(e,t,n){r(e).set(r(t),n>>>0)}function Be(e,t){const n=r(t).stack,_=q(n,o.__wbindgen_export_2,o.__wbindgen_export_3),i=y;a().setInt32(e+4*1,i,!0),a().setInt32(e+4*0,_,!0)}function Me(e){const t=r(e).value;return g(t)}function Se(e,t,n,_){console.warn(r(e),r(t),r(n),r(_))}function je(e){return+r(e)}function We(e){const t=BigInt.asUintN(64,e);return g(t)}function Ue(e,t){const n=r(t),_=typeof n=="bigint"?n:void 0;a().setBigInt64(e+8*1,I(_)?BigInt(0):_,!0),a().setInt32(e+4*0,!I(_),!0)}function Ee(e){const t=r(e);return typeof t=="boolean"?t?1:0:2}function qe(e,t){const n=U(r(t)),_=q(n,o.__wbindgen_export_2,o.__wbindgen_export_3),i=y;a().setInt32(e+4*1,i,!0),a().setInt32(e+4*0,_,!0)}function ze(e,t){const n=new Error(v(e,t));return g(n)}function Oe(e,t){return r(e) in r(t)}function Le(e){return typeof r(e)=="bigint"}function Ne(e){return typeof r(e)=="function"}function De(e){const t=r(e);return typeof t=="object"&&t!==null}function Fe(e){return r(e)===void 0}function Re(e,t){return r(e)===r(t)}function $e(e,t){return r(e)==r(t)}function Ve(){const e=o.memory;return g(e)}function Ce(e,t){const n=r(t),_=typeof n=="number"?n:void 0;a().setFloat64(e+8*1,I(_)?0:_,!0),a().setInt32(e+4*0,!I(_),!0)}function Ge(e){return g(e)}function Je(e){const t=r(e);return g(t)}function He(e){w(e)}function Pe(e,t){const n=r(t),_=typeof n=="string"?n:void 0;var i=I(_)?0:q(_,o.__wbindgen_export_2,o.__wbindgen_export_3),c=y;a().setInt32(e+4*1,c,!0),a().setInt32(e+4*0,i,!0)}function Ke(e,t){const n=v(e,t);return g(n)}function Qe(e,t){throw new Error(v(e,t))}URL=globalThis.URL;const l=await R({"./phomo_wasm_bg.js":{__wbindgen_object_drop_ref:He,__wbg_new_405e22f390576ce2:pe,__wbg_new_78feb108b6472713:ye,__wbindgen_number_new:Ge,__wbindgen_bigint_from_u64:We,__wbg_set_3f1d0b984ed272ed:ke,__wbg_set_37837023f3d740e8:xe,__wbindgen_error_new:ze,__wbindgen_is_object:De,__wbg_getwithrefkey_1dc361bd10053bfe:ae,__wbindgen_is_undefined:Fe,__wbindgen_in:Oe,__wbindgen_is_bigint:Le,__wbindgen_bigint_get_as_i64:Ue,__wbindgen_jsval_eq:Re,__wbg_isSafeInteger_343e2beeeece1bb0:fe,__wbindgen_as_number:je,__wbindgen_string_new:Ke,__wbg_error_524f506f44df1645:_e,__wbg_length_e2d2a49132c1b256:we,__wbg_get_b9b93047fe3cf45b:se,__wbg_new_a12002a7f91c75be:ve,__wbg_isArray_a1eab7e0d067391b:de,__wbg_iterator_9a24c88df860dc65:ge,__wbg_get_67b2ba62fc30de12:oe,__wbindgen_is_function:Ne,__wbg_call_672a4d21634d4a24:ee,__wbg_next_25feadfc0913fea9:Te,__wbg_next_6574e1a8a62d1055:Ie,__wbg_done_769e5ede4b31c67b:ne,__wbg_value_cd1ffa7b1ab794f1:Me,__wbg_new_8a6f238a6ece86ea:he,__wbg_stack_0ed75d68575b0f3c:Be,__wbg_error_7534b8e9a36f1ab4:re,__wbg_length_a446193dc22c12f8:le,__wbindgen_memory:Ve,__wbg_buffer_609cc3eee51ed158:Z,__wbg_set_65595bdd868b3009:Ae,__wbindgen_jsval_loose_eq:$e,__wbindgen_boolean_get:Ee,__wbindgen_number_get:Ce,__wbindgen_string_get:Pe,__wbg_instanceof_Uint8Array_17156bcf118086a9:ue,__wbg_instanceof_ArrayBuffer_e14585432e3737fc:be,__wbindgen_object_clone_ref:Je,__wbindgen_throw:Qe,__wbindgen_debug_string:qe,__wbg_error_80de38b3f7cc3c3c:ie,__wbg_warn_aaf1f4664a035bd6:Se,__wbg_info_033d8b8a0838f1d3:ce,__wbg_log_cad59bb680daec67:me,__wbg_debug_e17b51583ca6a632:te}},F),Xe=l.memory,Ye=l.init_panic_hook,Ze=l.overlayGrid,et=l.__wbg_mosaic_free,tt=l.mosaic_new,nt=l.mosaic_equalize,_t=l.mosaic_transferMasterToTiles,rt=l.mosaic_transferTilesToMaster,it=l.mosaic_build,ot=l.mosaic_buildWithSolver,st=l.mosaic_getTiles,at=l.mosaic_getMaster,ct=l.mosaic_buildBlueprint,bt=l.mosaic_buildBlueprintWithSolver,ut=l.mosaic_renderBlueprint,dt=l.__wbindgen_export_0,ft=l.__wbindgen_export_1,gt=l.__wbindgen_export_2,lt=l.__wbindgen_export_3,wt=l.__wbindgen_add_to_stack_pointer,L=l.__wbindgen_start;var mt=Object.freeze({__proto__:null,__wbg_mosaic_free:et,__wbindgen_add_to_stack_pointer:wt,__wbindgen_export_0:dt,__wbindgen_export_1:ft,__wbindgen_export_2:gt,__wbindgen_export_3:lt,__wbindgen_start:L,init_panic_hook:Ye,memory:Xe,mosaic_build:it,mosaic_buildBlueprint:ct,mosaic_buildBlueprintWithSolver:bt,mosaic_buildWithSolver:ot,mosaic_equalize:nt,mosaic_getMaster:at,mosaic_getTiles:st,mosaic_new:tt,mosaic_renderBlueprint:ut,mosaic_transferMasterToTiles:_t,mosaic_transferTilesToMaster:rt,overlayGrid:Ze});$(mt);L();const N=async e=>{const _=await (await (await fetch(e)).blob()).arrayBuffer();return new Uint8Array(_)};var j=(e=>(e.None="none",e.MasterToTile="masterToTile",e.TileToMaster="tileToMaster",e.Equalize="equalize",e))(j||{});const pt=async e=>Promise.all(e.map(t=>N(t)));self.onmessage=async e=>{console.log(e);const{masterImageUrl:t,tileImagesUrls:n,gridWidth:_,gridHeight:i,tileSizingMethod:c,tileRepeats:s,solver:b,colorMatchingMethod:d,mosaicImageSize:f}=e.data;console.log(e.data);try{const u=await N(t),m=await pt(n),h=new Y(u,m,_,i,s,c,f?Uint32Array.from(f):void 0);switch(d){case j.MasterToTile:h.transferMasterToTiles();break;case j.TileToMaster:h.transferTilesToMaster();break;case j.Equalize:h.equalize();break}const T=h.buildBlueprintWithSolver(X.NormL1,b),W=h.renderBlueprint(T);self.postMessage({mosaicTiles:h.getTiles(),mosaicBlueprint:T,mosaicImage:W})}catch(u){let m="An unknown error occurred.";u instanceof Error?m=u.message:typeof u=="string"&&(m=u),self.postMessage({error:m})}}})();