(async()=>{var L="/assets/phomo_wasm_bg-DMwn4p0q.wasm",N=async(e={},t)=>{let n;if(t.startsWith("data:")){const _=t.replace(/^data:.*?base64,/,"");let o;if(typeof Buffer=="function"&&typeof Buffer.from=="function")o=Buffer.from(_,"base64");else if(typeof atob=="function"){const c=atob(_);o=new Uint8Array(c.length);for(let s=0;s<c.length;s++)o[s]=c.charCodeAt(s)}else throw new Error("Cannot decode base64-encoded data URL");n=await WebAssembly.instantiate(o,e)}else{const _=await fetch(t),o=_.headers.get("Content-Type")||"";if("instantiateStreaming"in WebAssembly&&o.startsWith("application/wasm"))n=await WebAssembly.instantiateStreaming(_,e);else{const c=await _.arrayBuffer();n=await WebAssembly.instantiate(c,e)}}return n.instance.exports};let i;function R(e){i=e}const h=new Array(128).fill(void 0);h.push(void 0,null,!0,!1);function r(e){return h[e]}let A=h.length;function d(e){A===h.length&&h.push(h.length+1);const t=A;return A=h[t],h[t]=e,t}function E(e,t){try{return e.apply(this,t)}catch(n){i.__wbindgen_export_0(d(n))}}const $=typeof TextDecoder>"u"?(0,module.require)("util").TextDecoder:TextDecoder;let z=new $("utf-8",{ignoreBOM:!0,fatal:!0});z.decode();let B=null;function M(){return(B===null||B.byteLength===0)&&(B=new Uint8Array(i.memory.buffer)),B}function x(e,t){return e=e>>>0,z.decode(M().subarray(e,e+t))}function V(e){e<132||(h[e]=A,A=e)}function m(e){const t=r(e);return V(e),t}let p=0;const C=typeof TextEncoder>"u"?(0,module.require)("util").TextEncoder:TextEncoder;let U=new C("utf-8");const G=typeof U.encodeInto=="function"?function(e,t){return U.encodeInto(e,t)}:function(e,t){const n=U.encode(e);return t.set(n),{read:e.length,written:n.length}};function k(e,t,n){if(n===void 0){const b=U.encode(e),u=t(b.length,1)>>>0;return M().subarray(u,u+b.length).set(b),p=b.length,u}let _=e.length,o=t(_,1)>>>0;const c=M();let s=0;for(;s<_;s++){const b=e.charCodeAt(s);if(b>127)break;c[o+s]=b}if(s!==_){s!==0&&(e=e.slice(s)),o=n(o,_,_=s+e.length*3,1)>>>0;const b=M().subarray(o+s,o+_),u=G(e,b);s+=u.written,o=n(o,_,s,1)>>>0}return p=s,o}let I=null;function a(){return(I===null||I.buffer.detached===!0||I.buffer.detached===void 0&&I.buffer!==i.memory.buffer)&&(I=new DataView(i.memory.buffer)),I}function T(e){return e==null}function q(e){const t=typeof e;if(t=="number"||t=="boolean"||e==null)return`${e}`;if(t=="string")return`"${e}"`;if(t=="symbol"){const o=e.description;return o==null?"Symbol":`Symbol(${o})`}if(t=="function"){const o=e.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(e)){const o=e.length;let c="[";o>0&&(c+=q(e[0]));for(let s=1;s<o;s++)c+=", "+q(e[s]);return c+="]",c}const n=/\[object ([^\]]+)\]/.exec(toString.call(e));let _;if(n&&n.length>1)_=n[1];else return toString.call(e);if(_=="Object")try{return"Object("+JSON.stringify(e)+")"}catch{return"Object"}return e instanceof Error?`${e.name}: ${e.message}
${e.stack}`:_}function H(e,t){const n=t(e.length*1,1)>>>0;return M().set(e,n/1),p=e.length,n}let j=null;function J(){return(j===null||j.byteLength===0)&&(j=new Uint32Array(i.memory.buffer)),j}function P(e,t){const n=t(e.length*4,4)>>>0;return J().set(e,n/4),p=e.length,n}function K(e,t){e=e>>>0;const n=a(),_=[];for(let o=e;o<e+4*t;o+=4)_.push(m(n.getUint32(o,!0)));return _}const W=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>i.__wbg_mosaic_free(e>>>0,1));class Q{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,W.unregister(this),t}free(){const t=this.__destroy_into_raw();i.__wbg_mosaic_free(t,0)}constructor(t,n,_,o,c,s){try{const y=i.__wbindgen_add_to_stack_pointer(-16),v=H(t,i.__wbindgen_export_2),F=p;var b=T(s)?0:P(s,i.__wbindgen_export_2),u=p;i.mosaic_new(y,v,F,d(n),_,o,T(c)?2:c,b,u);var f=a().getInt32(y+4*0,!0),w=a().getInt32(y+4*1,!0),l=a().getInt32(y+4*2,!0);if(l)throw m(w);return this.__wbg_ptr=f>>>0,W.register(this,this.__wbg_ptr,this),this}finally{i.__wbindgen_add_to_stack_pointer(16)}}equalize(){i.mosaic_equalize(this.__wbg_ptr)}transferMasterToTiles(){i.mosaic_transferMasterToTiles(this.__wbg_ptr)}transferTilesToMaster(){try{const _=i.__wbindgen_add_to_stack_pointer(-16);i.mosaic_transferTilesToMaster(_,this.__wbg_ptr);var t=a().getInt32(_+4*0,!0),n=a().getInt32(_+4*1,!0);if(n)throw m(t)}finally{i.__wbindgen_add_to_stack_pointer(16)}}build(t,n){let _,o;try{const l=i.__wbindgen_add_to_stack_pointer(-16),y=k(t,i.__wbindgen_export_2,i.__wbindgen_export_3),v=p;i.mosaic_build(l,this.__wbg_ptr,y,v,T(n)?0x100000001:n>>>0);var c=a().getInt32(l+4*0,!0),s=a().getInt32(l+4*1,!0),b=a().getInt32(l+4*2,!0),u=a().getInt32(l+4*3,!0),f=c,w=s;if(u)throw f=0,w=0,m(b);return _=f,o=w,x(f,w)}finally{i.__wbindgen_add_to_stack_pointer(16),i.__wbindgen_export_1(_,o,1)}}getTiles(){try{const s=i.__wbindgen_add_to_stack_pointer(-16);i.mosaic_getTiles(s,this.__wbg_ptr);var t=a().getInt32(s+4*0,!0),n=a().getInt32(s+4*1,!0),_=a().getInt32(s+4*2,!0),o=a().getInt32(s+4*3,!0);if(o)throw m(_);var c=K(t,n).slice();return i.__wbindgen_export_1(t,n*4,4),c}finally{i.__wbindgen_add_to_stack_pointer(16)}}getMaster(){let t,n;try{const f=i.__wbindgen_add_to_stack_pointer(-16);i.mosaic_getMaster(f,this.__wbg_ptr);var _=a().getInt32(f+4*0,!0),o=a().getInt32(f+4*1,!0),c=a().getInt32(f+4*2,!0),s=a().getInt32(f+4*3,!0),b=_,u=o;if(s)throw b=0,u=0,m(c);return t=b,n=u,x(b,u)}finally{i.__wbindgen_add_to_stack_pointer(16),i.__wbindgen_export_1(t,n,1)}}buildBlueprint(t,n){try{const s=i.__wbindgen_add_to_stack_pointer(-16),b=k(t,i.__wbindgen_export_2,i.__wbindgen_export_3),u=p;i.mosaic_buildBlueprint(s,this.__wbg_ptr,b,u,T(n)?0x100000001:n>>>0);var _=a().getInt32(s+4*0,!0),o=a().getInt32(s+4*1,!0),c=a().getInt32(s+4*2,!0);if(c)throw m(o);return m(_)}finally{i.__wbindgen_add_to_stack_pointer(16)}}renderBlueprint(t){let n,_;try{const w=i.__wbindgen_add_to_stack_pointer(-16);i.mosaic_renderBlueprint(w,this.__wbg_ptr,d(t));var o=a().getInt32(w+4*0,!0),c=a().getInt32(w+4*1,!0),s=a().getInt32(w+4*2,!0),b=a().getInt32(w+4*3,!0),u=o,f=c;if(b)throw u=0,f=0,m(s);return n=u,_=f,x(u,f)}finally{i.__wbindgen_add_to_stack_pointer(16),i.__wbindgen_export_1(n,_,1)}}}function X(e){const t=r(e).buffer;return d(t)}function Y(){return E(function(e,t){const n=r(e).call(r(t));return d(n)},arguments)}function Z(e,t,n,_){console.debug(r(e),r(t),r(n),r(_))}function ee(e){return r(e).done}function te(e){console.error(r(e))}function ne(e,t){let n,_;try{n=e,_=t,console.error(x(e,t))}finally{i.__wbindgen_export_1(n,_,1)}}function _e(e,t,n,_){console.error(r(e),r(t),r(n),r(_))}function re(){return E(function(e,t){const n=Reflect.get(r(e),r(t));return d(n)},arguments)}function oe(e,t){const n=r(e)[t>>>0];return d(n)}function ie(e,t){const n=r(e)[r(t)];return d(n)}function se(e,t,n,_){console.info(r(e),r(t),r(n),r(_))}function ae(e){let t;try{t=r(e) instanceof ArrayBuffer}catch{t=!1}return t}function ce(e){let t;try{t=r(e) instanceof Uint8Array}catch{t=!1}return t}function be(e){return Array.isArray(r(e))}function ue(e){return Number.isSafeInteger(r(e))}function fe(){return d(Symbol.iterator)}function de(e){return r(e).length}function ge(e){return r(e).length}function we(e,t,n,_){console.log(r(e),r(t),r(n),r(_))}function le(){const e=new Object;return d(e)}function me(){const e=new Array;return d(e)}function pe(){const e=new Error;return d(e)}function ye(e){const t=new Uint8Array(r(e));return d(t)}function he(e){const t=r(e).next;return d(t)}function Te(){return E(function(e){const t=r(e).next();return d(t)},arguments)}function xe(e,t,n){r(e)[t>>>0]=m(n)}function Ie(e,t,n){r(e)[m(t)]=m(n)}function ve(e,t,n){r(e).set(r(t),n>>>0)}function Ae(e,t){const n=r(t).stack,_=k(n,i.__wbindgen_export_2,i.__wbindgen_export_3),o=p;a().setInt32(e+4*1,o,!0),a().setInt32(e+4*0,_,!0)}function Me(e){const t=r(e).value;return d(t)}function ke(e,t,n,_){console.warn(r(e),r(t),r(n),r(_))}function Be(e){return+r(e)}function je(e){const t=BigInt.asUintN(64,e);return d(t)}function Ue(e,t){const n=r(t),_=typeof n=="bigint"?n:void 0;a().setBigInt64(e+8*1,T(_)?BigInt(0):_,!0),a().setInt32(e+4*0,!T(_),!0)}function Se(e){const t=r(e);return typeof t=="boolean"?t?1:0:2}function qe(e,t){const n=q(r(t)),_=k(n,i.__wbindgen_export_2,i.__wbindgen_export_3),o=p;a().setInt32(e+4*1,o,!0),a().setInt32(e+4*0,_,!0)}function Ee(e,t){const n=new Error(x(e,t));return d(n)}function We(e,t){return r(e) in r(t)}function ze(e){return typeof r(e)=="bigint"}function Oe(e){return typeof r(e)=="function"}function De(e){const t=r(e);return typeof t=="object"&&t!==null}function Fe(e){return r(e)===void 0}function Le(e,t){return r(e)===r(t)}function Ne(e,t){return r(e)==r(t)}function Re(){const e=i.memory;return d(e)}function $e(e,t){const n=r(t),_=typeof n=="number"?n:void 0;a().setFloat64(e+8*1,T(_)?0:_,!0),a().setInt32(e+4*0,!T(_),!0)}function Ve(e){return d(e)}function Ce(e){const t=r(e);return d(t)}function Ge(e){m(e)}function He(e,t){const n=r(t),_=typeof n=="string"?n:void 0;var o=T(_)?0:k(_,i.__wbindgen_export_2,i.__wbindgen_export_3),c=p;a().setInt32(e+4*1,c,!0),a().setInt32(e+4*0,o,!0)}function Je(e,t){const n=x(e,t);return d(n)}function Pe(e,t){throw new Error(x(e,t))}URL=globalThis.URL;const g=await N({"./phomo_wasm_bg.js":{__wbindgen_object_drop_ref:Ge,__wbindgen_error_new:Ee,__wbindgen_is_object:De,__wbg_getwithrefkey_1dc361bd10053bfe:ie,__wbindgen_is_undefined:Fe,__wbindgen_in:We,__wbindgen_is_bigint:ze,__wbindgen_bigint_get_as_i64:Ue,__wbindgen_bigint_from_u64:je,__wbindgen_jsval_eq:Le,__wbg_isSafeInteger_343e2beeeece1bb0:ue,__wbindgen_as_number:Be,__wbindgen_string_new:Je,__wbg_error_524f506f44df1645:te,__wbg_length_e2d2a49132c1b256:ge,__wbg_get_b9b93047fe3cf45b:oe,__wbg_new_a12002a7f91c75be:ye,__wbg_new_405e22f390576ce2:le,__wbg_new_78feb108b6472713:me,__wbindgen_number_new:Ve,__wbg_set_3f1d0b984ed272ed:Ie,__wbg_set_37837023f3d740e8:xe,__wbg_isArray_a1eab7e0d067391b:be,__wbg_iterator_9a24c88df860dc65:fe,__wbg_get_67b2ba62fc30de12:re,__wbindgen_is_function:Oe,__wbg_call_672a4d21634d4a24:Y,__wbg_next_25feadfc0913fea9:he,__wbg_next_6574e1a8a62d1055:Te,__wbg_done_769e5ede4b31c67b:ee,__wbg_value_cd1ffa7b1ab794f1:Me,__wbg_new_8a6f238a6ece86ea:pe,__wbg_stack_0ed75d68575b0f3c:Ae,__wbg_error_7534b8e9a36f1ab4:ne,__wbg_length_a446193dc22c12f8:de,__wbindgen_memory:Re,__wbg_buffer_609cc3eee51ed158:X,__wbg_set_65595bdd868b3009:ve,__wbindgen_jsval_loose_eq:Ne,__wbindgen_boolean_get:Se,__wbindgen_number_get:$e,__wbindgen_string_get:He,__wbg_instanceof_Uint8Array_17156bcf118086a9:ce,__wbg_instanceof_ArrayBuffer_e14585432e3737fc:ae,__wbindgen_object_clone_ref:Ce,__wbindgen_throw:Pe,__wbindgen_debug_string:qe,__wbg_error_80de38b3f7cc3c3c:_e,__wbg_warn_aaf1f4664a035bd6:ke,__wbg_info_033d8b8a0838f1d3:se,__wbg_log_cad59bb680daec67:we,__wbg_debug_e17b51583ca6a632:Z}},L),Ke=g.memory,Qe=g.init_panic_hook,Xe=g.overlayGrid,Ye=g.__wbg_mosaic_free,Ze=g.mosaic_new,et=g.mosaic_equalize,tt=g.mosaic_transferMasterToTiles,nt=g.mosaic_transferTilesToMaster,_t=g.mosaic_build,rt=g.mosaic_getTiles,ot=g.mosaic_getMaster,it=g.mosaic_buildBlueprint,st=g.mosaic_renderBlueprint,at=g.__wbindgen_export_0,ct=g.__wbindgen_export_1,bt=g.__wbindgen_export_2,ut=g.__wbindgen_export_3,ft=g.__wbindgen_add_to_stack_pointer,O=g.__wbindgen_start;var dt=Object.freeze({__proto__:null,__wbg_mosaic_free:Ye,__wbindgen_add_to_stack_pointer:ft,__wbindgen_export_0:at,__wbindgen_export_1:ct,__wbindgen_export_2:bt,__wbindgen_export_3:ut,__wbindgen_start:O,init_panic_hook:Qe,memory:Ke,mosaic_build:_t,mosaic_buildBlueprint:it,mosaic_equalize:et,mosaic_getMaster:ot,mosaic_getTiles:rt,mosaic_new:Ze,mosaic_renderBlueprint:st,mosaic_transferMasterToTiles:tt,mosaic_transferTilesToMaster:nt,overlayGrid:Xe});R(dt);O();const D=async e=>{const _=await (await (await fetch(e)).blob()).arrayBuffer();return new Uint8Array(_)};var S=(e=>(e.None="none",e.MasterToTile="masterToTile",e.TileToMaster="tileToMaster",e.Equalize="equalize",e))(S||{});const gt=async e=>Promise.all(e.map(t=>D(t)));self.onmessage=async e=>{console.log(e);const{masterImageUrl:t,tileImagesUrls:n,gridWidth:_,gridHeight:o,tileSizingMethod:c,tileRepeats:s,colorMatchingMethod:b,mosaicImageSize:u}=e.data;console.log(e.data);try{const f=await D(t),w=await gt(n),l=new Q(f,w,_,o,c,u?Uint32Array.from(u):void 0);switch(b){case S.MasterToTile:l.transferMasterToTiles();break;case S.TileToMaster:l.transferTilesToMaster();break;case S.Equalize:l.equalize();break}const y=l.buildBlueprint("NormL1",s),v=l.renderBlueprint(y);self.postMessage({mosaicTiles:l.getTiles(),mosaicBlueprint:y,mosaicImage:v})}catch(f){let w="An unknown error occurred.";f instanceof Error?w=f.message:typeof f=="string"&&(w=f),self.postMessage({error:w})}}})();