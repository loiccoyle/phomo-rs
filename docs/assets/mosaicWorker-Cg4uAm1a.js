(async()=>{function C(t,e){return new Promise(n=>{t.addEventListener("message",function r({data:i}){i?.type===e&&(t.removeEventListener("message",r),n(i))})})}C(self,"wasm_bindgen_worker_init").then(async({init:t,receiver:e})=>{const n=await Promise.resolve().then(function(){return ce});await n.default(t),postMessage({type:"wasm_bindgen_worker_ready"}),n.wbg_rayon_start_worker(e)});async function J(t,e,n){if(n.numThreads()===0)throw new Error("num_threads must be > 0.");const r={type:"wasm_bindgen_worker_init",init:{module_or_path:t,memory:e},receiver:n.receiver()};await Promise.all(Array.from({length:n.numThreads()},async()=>{const i=new Worker(new URL("/assets/workerHelpers-C35CONNj.js",import.meta.url),{type:"module"});return i.postMessage(r),await C(i,"wasm_bindgen_worker_ready"),i})),n.build()}let o;const I=new Array(128).fill(void 0);I.push(void 0,null,!0,!1);function _(t){return I[t]}let M=I.length;function u(t){M===I.length&&I.push(I.length+1);const e=M;return M=I[e],I[e]=t,e}function L(t,e){try{return t.apply(this,e)}catch(n){o.__wbindgen_export_0(u(n))}}const F=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&F.decode();let T=null;function j(){return(T===null||T.buffer!==o.memory.buffer)&&(T=new Uint8Array(o.memory.buffer)),T}function m(t,e){return t=t>>>0,F.decode(j().slice(t,t+e))}function Y(t){t<132||(I[t]=M,M=t)}function l(t){const e=_(t);return Y(t),e}let h=0;const N=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},K=function(t,e){const n=N.encode(t);return e.set(n),{read:t.length,written:n.length}};function z(t,e,n){if(n===void 0){const b=N.encode(t),f=e(b.length,1)>>>0;return j().subarray(f,f+b.length).set(b),h=b.length,f}let r=t.length,i=e(r,1)>>>0;const c=j();let a=0;for(;a<r;a++){const b=t.charCodeAt(a);if(b>127)break;c[i+a]=b}if(a!==r){a!==0&&(t=t.slice(a)),i=n(i,r,r=a+t.length*3,1)>>>0;const b=j().subarray(i+a,i+r),f=K(t,b);a+=f.written,i=n(i,r,a,1)>>>0}return h=a,i}let k=null;function s(){return(k===null||k.buffer!==o.memory.buffer)&&(k=new DataView(o.memory.buffer)),k}function p(t){return t==null}function E(t){const e=typeof t;if(e=="number"||e=="boolean"||t==null)return`${t}`;if(e=="string")return`"${t}"`;if(e=="symbol"){const i=t.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=t.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(t)){const i=t.length;let c="[";i>0&&(c+=E(t[0]));for(let a=1;a<i;a++)c+=", "+E(t[a]);return c+="]",c}const n=/\[object ([^\]]+)\]/.exec(toString.call(t));let r;if(n&&n.length>1)r=n[1];else return toString.call(t);if(r=="Object")try{return"Object("+JSON.stringify(t)+")"}catch{return"Object"}return t instanceof Error?`${t.name}: ${t.message}
${t.stack}`:r}function Q(){o.init_panic_hook()}function q(t,e){const n=e(t.length*1,1)>>>0;return j().set(t,n/1),h=t.length,n}function X(t,e,n){let r,i;try{const d=o.__wbindgen_add_to_stack_pointer(-16),v=q(t,o.__wbindgen_export_3),y=h;o.overlayGrid(d,v,y,e,n);var c=s().getInt32(d+4*0,!0),a=s().getInt32(d+4*1,!0),b=s().getInt32(d+4*2,!0),f=s().getInt32(d+4*3,!0),g=c,w=a;if(f)throw g=0,w=0,l(b);return r=g,i=w,m(g,w)}finally{o.__wbindgen_add_to_stack_pointer(16),o.__wbindgen_export_1(r,i,1)}}let A=null;function Z(){return(A===null||A.buffer!==o.memory.buffer)&&(A=new Uint32Array(o.memory.buffer)),A}function ee(t,e){const n=e(t.length*4,4)>>>0;return Z().set(t,n/4),h=t.length,n}function te(t,e){t=t>>>0;const n=s(),r=[];for(let i=t;i<t+4*e;i+=4)r.push(l(n.getUint32(i,!0)));return r}function P(t){const e=o.initThreadPool(t);return l(e)}function ne(t){o.wbg_rayon_start_worker(t)}const re=Object.freeze({Cs420:0,0:"Cs420",Cs422:1,1:"Cs422",Cs444:2,2:"Cs444",Cs400:3,3:"Cs400"}),ie=Object.freeze({NormL1:0,0:"NormL1",NormL2:1,1:"NormL2",LuminanceL1:2,2:"LuminanceL1",LuminanceL2:3,3:"LuminanceL2",AvgColor:4,4:"AvgColor"}),oe=Object.freeze({Crop:0,0:"Crop",Resize:1,1:"Resize"}),_e=Object.freeze({Greedy:0,0:"Greedy",Hungarian:1,1:"Hungarian",Auction:2,2:"Auction"}),U=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>o.__wbg_mosaic_free(t>>>0,1));class D{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,U.unregister(this),e}free(){const e=this.__destroy_into_raw();o.__wbg_mosaic_free(e,0)}constructor(e,n,r,i,c,a,b){try{const y=o.__wbindgen_add_to_stack_pointer(-16),x=q(e,o.__wbindgen_export_3),O=h;var f=p(b)?0:ee(b,o.__wbindgen_export_3),g=h;o.mosaic_new(y,x,O,u(n),r,i,c,p(a)?2:a,f,g);var w=s().getInt32(y+4*0,!0),d=s().getInt32(y+4*1,!0),v=s().getInt32(y+4*2,!0);if(v)throw l(d);return this.__wbg_ptr=w>>>0,U.register(this,this.__wbg_ptr,this),this}finally{o.__wbindgen_add_to_stack_pointer(16)}}equalize(){o.mosaic_equalize(this.__wbg_ptr)}transferMasterToTiles(){o.mosaic_transferMasterToTiles(this.__wbg_ptr)}transferTilesToMaster(){try{const r=o.__wbindgen_add_to_stack_pointer(-16);o.mosaic_transferTilesToMaster(r,this.__wbg_ptr);var e=s().getInt32(r+4*0,!0),n=s().getInt32(r+4*1,!0);if(n)throw l(e)}finally{o.__wbindgen_add_to_stack_pointer(16)}}build(e){let n,r;try{const w=o.__wbindgen_add_to_stack_pointer(-16);o.mosaic_build(w,this.__wbg_ptr,e);var i=s().getInt32(w+4*0,!0),c=s().getInt32(w+4*1,!0),a=s().getInt32(w+4*2,!0),b=s().getInt32(w+4*3,!0),f=i,g=c;if(b)throw f=0,g=0,l(a);return n=f,r=g,m(f,g)}finally{o.__wbindgen_add_to_stack_pointer(16),o.__wbindgen_export_1(n,r,1)}}buildWithSolver(e,n){let r,i;try{const d=o.__wbindgen_add_to_stack_pointer(-16);o.mosaic_buildWithSolver(d,this.__wbg_ptr,e,n);var c=s().getInt32(d+4*0,!0),a=s().getInt32(d+4*1,!0),b=s().getInt32(d+4*2,!0),f=s().getInt32(d+4*3,!0),g=c,w=a;if(f)throw g=0,w=0,l(b);return r=g,i=w,m(g,w)}finally{o.__wbindgen_add_to_stack_pointer(16),o.__wbindgen_export_1(r,i,1)}}getTiles(){try{const a=o.__wbindgen_add_to_stack_pointer(-16);o.mosaic_getTiles(a,this.__wbg_ptr);var e=s().getInt32(a+4*0,!0),n=s().getInt32(a+4*1,!0),r=s().getInt32(a+4*2,!0),i=s().getInt32(a+4*3,!0);if(i)throw l(r);var c=te(e,n).slice();return o.__wbindgen_export_1(e,n*4,4),c}finally{o.__wbindgen_add_to_stack_pointer(16)}}getMaster(){let e,n;try{const g=o.__wbindgen_add_to_stack_pointer(-16);o.mosaic_getMaster(g,this.__wbg_ptr);var r=s().getInt32(g+4*0,!0),i=s().getInt32(g+4*1,!0),c=s().getInt32(g+4*2,!0),a=s().getInt32(g+4*3,!0),b=r,f=i;if(a)throw b=0,f=0,l(c);return e=b,n=f,m(b,f)}finally{o.__wbindgen_add_to_stack_pointer(16),o.__wbindgen_export_1(e,n,1)}}buildBlueprint(e){try{const c=o.__wbindgen_add_to_stack_pointer(-16);o.mosaic_buildBlueprint(c,this.__wbg_ptr,e);var n=s().getInt32(c+4*0,!0),r=s().getInt32(c+4*1,!0),i=s().getInt32(c+4*2,!0);if(i)throw l(r);return l(n)}finally{o.__wbindgen_add_to_stack_pointer(16)}}buildBlueprintWithSolver(e,n){try{const a=o.__wbindgen_add_to_stack_pointer(-16);o.mosaic_buildBlueprintWithSolver(a,this.__wbg_ptr,e,n);var r=s().getInt32(a+4*0,!0),i=s().getInt32(a+4*1,!0),c=s().getInt32(a+4*2,!0);if(c)throw l(i);return l(r)}finally{o.__wbindgen_add_to_stack_pointer(16)}}renderBlueprint(e){let n,r;try{const w=o.__wbindgen_add_to_stack_pointer(-16);o.mosaic_renderBlueprint(w,this.__wbg_ptr,u(e));var i=s().getInt32(w+4*0,!0),c=s().getInt32(w+4*1,!0),a=s().getInt32(w+4*2,!0),b=s().getInt32(w+4*3,!0),f=i,g=c;if(b)throw f=0,g=0,l(a);return n=f,r=g,m(f,g)}finally{o.__wbindgen_add_to_stack_pointer(16),o.__wbindgen_export_1(n,r,1)}}}const R=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>o.__wbg_wbg_rayon_poolbuilder_free(t>>>0,1));class W{static __wrap(e){e=e>>>0;const n=Object.create(W.prototype);return n.__wbg_ptr=e,R.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,R.unregister(this),e}free(){const e=this.__destroy_into_raw();o.__wbg_wbg_rayon_poolbuilder_free(e,0)}numThreads(){return o.wbg_rayon_poolbuilder_numThreads(this.__wbg_ptr)>>>0}receiver(){return o.wbg_rayon_poolbuilder_receiver(this.__wbg_ptr)>>>0}build(){o.wbg_rayon_poolbuilder_build(this.__wbg_ptr)}}async function se(t,e){if(typeof Response=="function"&&t instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(t,e)}catch(r){if(t.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const n=await t.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(t,e);return n instanceof WebAssembly.Instance?{instance:n,module:t}:n}}function G(){const t={};return t.wbg={},t.wbg.__wbg_buffer_609cc3eee51ed158=function(e){const n=_(e).buffer;return u(n)},t.wbg.__wbg_call_672a4d21634d4a24=function(){return L(function(e,n){const r=_(e).call(_(n));return u(r)},arguments)},t.wbg.__wbg_debug_e17b51583ca6a632=function(e,n,r,i){console.debug(_(e),_(n),_(r),_(i))},t.wbg.__wbg_done_769e5ede4b31c67b=function(e){return _(e).done},t.wbg.__wbg_error_524f506f44df1645=function(e){console.error(_(e))},t.wbg.__wbg_error_7534b8e9a36f1ab4=function(e,n){let r,i;try{r=e,i=n,console.error(m(e,n))}finally{o.__wbindgen_export_1(r,i,1)}},t.wbg.__wbg_error_80de38b3f7cc3c3c=function(e,n,r,i){console.error(_(e),_(n),_(r),_(i))},t.wbg.__wbg_get_67b2ba62fc30de12=function(){return L(function(e,n){const r=Reflect.get(_(e),_(n));return u(r)},arguments)},t.wbg.__wbg_get_b9b93047fe3cf45b=function(e,n){const r=_(e)[n>>>0];return u(r)},t.wbg.__wbg_getwithrefkey_1dc361bd10053bfe=function(e,n){const r=_(e)[_(n)];return u(r)},t.wbg.__wbg_info_033d8b8a0838f1d3=function(e,n,r,i){console.info(_(e),_(n),_(r),_(i))},t.wbg.__wbg_instanceof_ArrayBuffer_e14585432e3737fc=function(e){let n;try{n=_(e) instanceof ArrayBuffer}catch{n=!1}return n},t.wbg.__wbg_instanceof_Uint8Array_17156bcf118086a9=function(e){let n;try{n=_(e) instanceof Uint8Array}catch{n=!1}return n},t.wbg.__wbg_instanceof_Window_def73ea0955fc569=function(e){let n;try{n=_(e) instanceof Window}catch{n=!1}return n},t.wbg.__wbg_isArray_a1eab7e0d067391b=function(e){return Array.isArray(_(e))},t.wbg.__wbg_isSafeInteger_343e2beeeece1bb0=function(e){return Number.isSafeInteger(_(e))},t.wbg.__wbg_iterator_9a24c88df860dc65=function(){return u(Symbol.iterator)},t.wbg.__wbg_length_a446193dc22c12f8=function(e){return _(e).length},t.wbg.__wbg_length_e2d2a49132c1b256=function(e){return _(e).length},t.wbg.__wbg_log_cad59bb680daec67=function(e,n,r,i){console.log(_(e),_(n),_(r),_(i))},t.wbg.__wbg_new_405e22f390576ce2=function(){const e=new Object;return u(e)},t.wbg.__wbg_new_78feb108b6472713=function(){const e=new Array;return u(e)},t.wbg.__wbg_new_8a6f238a6ece86ea=function(){const e=new Error;return u(e)},t.wbg.__wbg_new_a12002a7f91c75be=function(e){const n=new Uint8Array(_(e));return u(n)},t.wbg.__wbg_newnoargs_105ed471475aaf50=function(e,n){const r=new Function(m(e,n));return u(r)},t.wbg.__wbg_next_25feadfc0913fea9=function(e){const n=_(e).next;return u(n)},t.wbg.__wbg_next_6574e1a8a62d1055=function(){return L(function(e){const n=_(e).next();return u(n)},arguments)},t.wbg.__wbg_set_37837023f3d740e8=function(e,n,r){_(e)[n>>>0]=l(r)},t.wbg.__wbg_set_3f1d0b984ed272ed=function(e,n,r){_(e)[l(n)]=l(r)},t.wbg.__wbg_set_65595bdd868b3009=function(e,n,r){_(e).set(_(n),r>>>0)},t.wbg.__wbg_stack_0ed75d68575b0f3c=function(e,n){const r=_(n).stack,i=z(r,o.__wbindgen_export_3,o.__wbindgen_export_4),c=h;s().setInt32(e+4*1,c,!0),s().setInt32(e+4*0,i,!0)},t.wbg.__wbg_startWorkers_2ca11761e08ff5d5=function(e,n,r){const i=J(l(e),l(n),W.__wrap(r));return u(i)},t.wbg.__wbg_static_accessor_GLOBAL_88a902d13a557d07=function(){const e=typeof global>"u"?null:global;return p(e)?0:u(e)},t.wbg.__wbg_static_accessor_GLOBAL_THIS_56578be7e9f832b0=function(){const e=typeof globalThis>"u"?null:globalThis;return p(e)?0:u(e)},t.wbg.__wbg_static_accessor_SELF_37c5d418e4bf5819=function(){const e=typeof self>"u"?null:self;return p(e)?0:u(e)},t.wbg.__wbg_static_accessor_WINDOW_5de37043a91a9c40=function(){const e=typeof window>"u"?null:window;return p(e)?0:u(e)},t.wbg.__wbg_value_cd1ffa7b1ab794f1=function(e){const n=_(e).value;return u(n)},t.wbg.__wbg_warn_aaf1f4664a035bd6=function(e,n,r,i){console.warn(_(e),_(n),_(r),_(i))},t.wbg.__wbindgen_as_number=function(e){return+_(e)},t.wbg.__wbindgen_bigint_from_u64=function(e){const n=BigInt.asUintN(64,e);return u(n)},t.wbg.__wbindgen_bigint_get_as_i64=function(e,n){const r=_(n),i=typeof r=="bigint"?r:void 0;s().setBigInt64(e+8*1,p(i)?BigInt(0):i,!0),s().setInt32(e+4*0,!p(i),!0)},t.wbg.__wbindgen_boolean_get=function(e){const n=_(e);return typeof n=="boolean"?n?1:0:2},t.wbg.__wbindgen_debug_string=function(e,n){const r=E(_(n)),i=z(r,o.__wbindgen_export_3,o.__wbindgen_export_4),c=h;s().setInt32(e+4*1,c,!0),s().setInt32(e+4*0,i,!0)},t.wbg.__wbindgen_error_new=function(e,n){const r=new Error(m(e,n));return u(r)},t.wbg.__wbindgen_in=function(e,n){return _(e) in _(n)},t.wbg.__wbindgen_is_bigint=function(e){return typeof _(e)=="bigint"},t.wbg.__wbindgen_is_function=function(e){return typeof _(e)=="function"},t.wbg.__wbindgen_is_object=function(e){const n=_(e);return typeof n=="object"&&n!==null},t.wbg.__wbindgen_is_undefined=function(e){return _(e)===void 0},t.wbg.__wbindgen_jsval_eq=function(e,n){return _(e)===_(n)},t.wbg.__wbindgen_jsval_loose_eq=function(e,n){return _(e)==_(n)},t.wbg.__wbindgen_memory=function(){const e=o.memory;return u(e)},t.wbg.__wbindgen_module=function(){const e=B.__wbindgen_wasm_module;return u(e)},t.wbg.__wbindgen_number_get=function(e,n){const r=_(n),i=typeof r=="number"?r:void 0;s().setFloat64(e+8*1,p(i)?0:i,!0),s().setInt32(e+4*0,!p(i),!0)},t.wbg.__wbindgen_number_new=function(e){return u(e)},t.wbg.__wbindgen_object_clone_ref=function(e){const n=_(e);return u(n)},t.wbg.__wbindgen_object_drop_ref=function(e){l(e)},t.wbg.__wbindgen_string_get=function(e,n){const r=_(n),i=typeof r=="string"?r:void 0;var c=p(i)?0:z(i,o.__wbindgen_export_3,o.__wbindgen_export_4),a=h;s().setInt32(e+4*1,a,!0),s().setInt32(e+4*0,c,!0)},t.wbg.__wbindgen_string_new=function(e,n){const r=m(e,n);return u(r)},t.wbg.__wbindgen_throw=function(e,n){throw new Error(m(e,n))},t}function $(t,e){t.wbg.memory=e||new WebAssembly.Memory({initial:22,maximum:16384,shared:!0})}function H(t,e,n){if(o=t.exports,B.__wbindgen_wasm_module=e,k=null,A=null,T=null,typeof n<"u"&&(typeof n!="number"||n===0||n%65536!==0))throw"invalid stack size";return o.__wbindgen_start(n),o}function ae(t,e){if(o!==void 0)return o;let n;typeof t<"u"&&(Object.getPrototypeOf(t)===Object.prototype?{module:t,memory:e,thread_stack_size:n}=t:console.warn("using deprecated parameters for `initSync()`; pass a single object instead"));const r=G();$(r,e),t instanceof WebAssembly.Module||(t=new WebAssembly.Module(t));const i=new WebAssembly.Instance(t,r);return H(i,t,n)}async function B(t,e){if(o!==void 0)return o;let n;typeof t<"u"&&(Object.getPrototypeOf(t)===Object.prototype?{module_or_path:t,memory:e,thread_stack_size:n}=t:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof t>"u"&&(t=new URL("/assets/phomo_wasm_bg-B0Yq1l3d.wasm",import.meta.url));const r=G();(typeof t=="string"||typeof Request=="function"&&t instanceof Request||typeof URL=="function"&&t instanceof URL)&&(t=fetch(t)),$(r,e);const{instance:i,module:c}=await se(await t,r);return H(i,c,n)}var ce=Object.freeze({__proto__:null,ChromaSampling:re,MetricType:ie,Mosaic:D,ResizeType:oe,Solver:_e,default:B,initSync:ae,initThreadPool:P,init_panic_hook:Q,overlayGrid:X,wbg_rayon_PoolBuilder:W,wbg_rayon_start_worker:ne});const V=async t=>{const r=await (await (await fetch(t)).blob()).arrayBuffer();return new Uint8Array(r)};var S=(t=>(t.None="none",t.MasterToTile="masterToTile",t.TileToMaster="tileToMaster",t.Equalize="equalize",t))(S||{});const ue=new URL("/assets/phomo_wasm_bg-B0Yq1l3d.wasm",import.meta.url);await B(ue.href);await P(navigator.hardwareConcurrency||1);const be=async t=>Promise.all(t.map(e=>V(e)));self.onmessage=async t=>{console.log(t);const{masterImageUrl:e,tileImagesUrls:n,gridWidth:r,gridHeight:i,tileSizingMethod:c,tileRepeats:a,solver:b,metric:f,colorMatchingMethod:g,mosaicImageSize:w}=t.data;console.log(t.data);try{const d=await V(e),v=await be(n),y=new D(d,v,r,i,a,c,w?Uint32Array.from(w):void 0);switch(g){case S.MasterToTile:y.transferMasterToTiles();break;case S.TileToMaster:y.transferTilesToMaster();break;case S.Equalize:y.equalize();break}const x=y.buildBlueprintWithSolver(f,b),O=y.renderBlueprint(x);self.postMessage({mosaicTiles:y.getTiles(),mosaicBlueprint:x,mosaicImage:O})}catch(d){let v="An unknown error occurred.";d instanceof Error?v=d.message:typeof d=="string"&&(v=d),self.postMessage({error:v})}}})();