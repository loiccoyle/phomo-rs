(async()=>{var D="/assets/phomo_wasm_bg-hrdkzq59.wasm",R=async(e={},t)=>{let n;if(t.startsWith("data:")){const _=t.replace(/^data:.*?base64,/,"");let o;if(typeof Buffer=="function"&&typeof Buffer.from=="function")o=Buffer.from(_,"base64");else if(typeof atob=="function"){const c=atob(_);o=new Uint8Array(c.length);for(let s=0;s<c.length;s++)o[s]=c.charCodeAt(s)}else throw new Error("Cannot decode base64-encoded data URL");n=await WebAssembly.instantiate(o,e)}else{const _=await fetch(t),o=_.headers.get("Content-Type")||"";if("instantiateStreaming"in WebAssembly&&o.startsWith("application/wasm"))n=await WebAssembly.instantiateStreaming(_,e);else{const c=await _.arrayBuffer();n=await WebAssembly.instantiate(c,e)}}return n.instance.exports};let i;function $(e){i=e}const T=new Array(128).fill(void 0);T.push(void 0,null,!0,!1);function r(e){return T[e]}let A=T.length;function f(e){A===T.length&&T.push(T.length+1);const t=A;return A=T[t],T[t]=e,t}function z(e,t){try{return e.apply(this,t)}catch(n){i.__wbindgen_export_0(f(n))}}const V=typeof TextDecoder>"u"?(0,module.require)("util").TextDecoder:TextDecoder;let W=new V("utf-8",{ignoreBOM:!0,fatal:!0});W.decode();let M=null;function B(){return(M===null||M.byteLength===0)&&(M=new Uint8Array(i.memory.buffer)),M}function I(e,t){return e=e>>>0,W.decode(B().subarray(e,e+t))}function C(e){e<132||(T[e]=A,A=e)}function l(e){const t=r(e);return C(e),t}let p=0;const H=typeof TextEncoder>"u"?(0,module.require)("util").TextEncoder:TextEncoder;let U=new H("utf-8");const J=typeof U.encodeInto=="function"?function(e,t){return U.encodeInto(e,t)}:function(e,t){const n=U.encode(e);return t.set(n),{read:e.length,written:n.length}};function x(e,t,n){if(n===void 0){const b=U.encode(e),u=t(b.length,1)>>>0;return B().subarray(u,u+b.length).set(b),p=b.length,u}let _=e.length,o=t(_,1)>>>0;const c=B();let s=0;for(;s<_;s++){const b=e.charCodeAt(s);if(b>127)break;c[o+s]=b}if(s!==_){s!==0&&(e=e.slice(s)),o=n(o,_,_=s+e.length*3,1)>>>0;const b=B().subarray(o+s,o+_),u=J(e,b);s+=u.written,o=n(o,_,s,1)>>>0}return p=s,o}let k=null;function a(){return(k===null||k.buffer.detached===!0||k.buffer.detached===void 0&&k.buffer!==i.memory.buffer)&&(k=new DataView(i.memory.buffer)),k}function v(e){return e==null}function E(e){const t=typeof e;if(t=="number"||t=="boolean"||e==null)return`${e}`;if(t=="string")return`"${e}"`;if(t=="symbol"){const o=e.description;return o==null?"Symbol":`Symbol(${o})`}if(t=="function"){const o=e.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(e)){const o=e.length;let c="[";o>0&&(c+=E(e[0]));for(let s=1;s<o;s++)c+=", "+E(e[s]);return c+="]",c}const n=/\[object ([^\]]+)\]/.exec(toString.call(e));let _;if(n&&n.length>1)_=n[1];else return toString.call(e);if(_=="Object")try{return"Object("+JSON.stringify(e)+")"}catch{return"Object"}return e instanceof Error?`${e.name}: ${e.message}
${e.stack}`:_}function P(e,t){const n=t(e.length*1,1)>>>0;return B().set(e,n/1),p=e.length,n}let j=null;function K(){return(j===null||j.byteLength===0)&&(j=new Uint32Array(i.memory.buffer)),j}function Q(e,t){const n=t(e.length*4,4)>>>0;return K().set(e,n/4),p=e.length,n}function X(e,t){e=e>>>0;const n=a(),_=[];for(let o=e;o<e+4*t;o+=4)_.push(l(n.getUint32(o,!0)));return _}const O=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>i.__wbg_mosaic_free(e>>>0,1));class Y{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,O.unregister(this),t}free(){const t=this.__destroy_into_raw();i.__wbg_mosaic_free(t,0)}constructor(t,n,_,o,c,s,b){try{const h=i.__wbindgen_add_to_stack_pointer(-16),q=P(t,i.__wbindgen_export_2),N=p;var u=v(b)?0:Q(b,i.__wbindgen_export_2),g=p;i.mosaic_new(h,q,N,f(n),_,o,c,v(s)?2:s,u,g);var d=a().getInt32(h+4*0,!0),y=a().getInt32(h+4*1,!0),m=a().getInt32(h+4*2,!0);if(m)throw l(y);return this.__wbg_ptr=d>>>0,O.register(this,this.__wbg_ptr,this),this}finally{i.__wbindgen_add_to_stack_pointer(16)}}equalize(){i.mosaic_equalize(this.__wbg_ptr)}transferMasterToTiles(){i.mosaic_transferMasterToTiles(this.__wbg_ptr)}transferTilesToMaster(){try{const _=i.__wbindgen_add_to_stack_pointer(-16);i.mosaic_transferTilesToMaster(_,this.__wbg_ptr);var t=a().getInt32(_+4*0,!0),n=a().getInt32(_+4*1,!0);if(n)throw l(t)}finally{i.__wbindgen_add_to_stack_pointer(16)}}build(t){let n,_;try{const d=i.__wbindgen_add_to_stack_pointer(-16),y=x(t,i.__wbindgen_export_2,i.__wbindgen_export_3),m=p;i.mosaic_build(d,this.__wbg_ptr,y,m);var o=a().getInt32(d+4*0,!0),c=a().getInt32(d+4*1,!0),s=a().getInt32(d+4*2,!0),b=a().getInt32(d+4*3,!0),u=o,g=c;if(b)throw u=0,g=0,l(s);return n=u,_=g,I(u,g)}finally{i.__wbindgen_add_to_stack_pointer(16),i.__wbindgen_export_1(n,_,1)}}buildGreedy(t){let n,_;try{const d=i.__wbindgen_add_to_stack_pointer(-16),y=x(t,i.__wbindgen_export_2,i.__wbindgen_export_3),m=p;i.mosaic_buildGreedy(d,this.__wbg_ptr,y,m);var o=a().getInt32(d+4*0,!0),c=a().getInt32(d+4*1,!0),s=a().getInt32(d+4*2,!0),b=a().getInt32(d+4*3,!0),u=o,g=c;if(b)throw u=0,g=0,l(s);return n=u,_=g,I(u,g)}finally{i.__wbindgen_add_to_stack_pointer(16),i.__wbindgen_export_1(n,_,1)}}getTiles(){try{const s=i.__wbindgen_add_to_stack_pointer(-16);i.mosaic_getTiles(s,this.__wbg_ptr);var t=a().getInt32(s+4*0,!0),n=a().getInt32(s+4*1,!0),_=a().getInt32(s+4*2,!0),o=a().getInt32(s+4*3,!0);if(o)throw l(_);var c=X(t,n).slice();return i.__wbindgen_export_1(t,n*4,4),c}finally{i.__wbindgen_add_to_stack_pointer(16)}}getMaster(){let t,n;try{const g=i.__wbindgen_add_to_stack_pointer(-16);i.mosaic_getMaster(g,this.__wbg_ptr);var _=a().getInt32(g+4*0,!0),o=a().getInt32(g+4*1,!0),c=a().getInt32(g+4*2,!0),s=a().getInt32(g+4*3,!0),b=_,u=o;if(s)throw b=0,u=0,l(c);return t=b,n=u,I(b,u)}finally{i.__wbindgen_add_to_stack_pointer(16),i.__wbindgen_export_1(t,n,1)}}buildBlueprint(t){try{const c=i.__wbindgen_add_to_stack_pointer(-16),s=x(t,i.__wbindgen_export_2,i.__wbindgen_export_3),b=p;i.mosaic_buildBlueprint(c,this.__wbg_ptr,s,b);var n=a().getInt32(c+4*0,!0),_=a().getInt32(c+4*1,!0),o=a().getInt32(c+4*2,!0);if(o)throw l(_);return l(n)}finally{i.__wbindgen_add_to_stack_pointer(16)}}buildBlueprintGreedy(t){try{const c=i.__wbindgen_add_to_stack_pointer(-16),s=x(t,i.__wbindgen_export_2,i.__wbindgen_export_3),b=p;i.mosaic_buildBlueprintGreedy(c,this.__wbg_ptr,s,b);var n=a().getInt32(c+4*0,!0),_=a().getInt32(c+4*1,!0),o=a().getInt32(c+4*2,!0);if(o)throw l(_);return l(n)}finally{i.__wbindgen_add_to_stack_pointer(16)}}renderBlueprint(t){let n,_;try{const d=i.__wbindgen_add_to_stack_pointer(-16);i.mosaic_renderBlueprint(d,this.__wbg_ptr,f(t));var o=a().getInt32(d+4*0,!0),c=a().getInt32(d+4*1,!0),s=a().getInt32(d+4*2,!0),b=a().getInt32(d+4*3,!0),u=o,g=c;if(b)throw u=0,g=0,l(s);return n=u,_=g,I(u,g)}finally{i.__wbindgen_add_to_stack_pointer(16),i.__wbindgen_export_1(n,_,1)}}}function Z(e){const t=r(e).buffer;return f(t)}function ee(){return z(function(e,t){const n=r(e).call(r(t));return f(n)},arguments)}function te(e,t,n,_){console.debug(r(e),r(t),r(n),r(_))}function ne(e){return r(e).done}function _e(e){console.error(r(e))}function re(e,t){let n,_;try{n=e,_=t,console.error(I(e,t))}finally{i.__wbindgen_export_1(n,_,1)}}function ie(e,t,n,_){console.error(r(e),r(t),r(n),r(_))}function oe(){return z(function(e,t){const n=Reflect.get(r(e),r(t));return f(n)},arguments)}function se(e,t){const n=r(e)[t>>>0];return f(n)}function ae(e,t){const n=r(e)[r(t)];return f(n)}function ce(e,t,n,_){console.info(r(e),r(t),r(n),r(_))}function be(e){let t;try{t=r(e) instanceof ArrayBuffer}catch{t=!1}return t}function de(e){let t;try{t=r(e) instanceof Uint8Array}catch{t=!1}return t}function ue(e){return Array.isArray(r(e))}function ge(e){return Number.isSafeInteger(r(e))}function fe(){return f(Symbol.iterator)}function we(e){return r(e).length}function le(e){return r(e).length}function me(e,t,n,_){console.log(r(e),r(t),r(n),r(_))}function pe(){const e=new Object;return f(e)}function ye(){const e=new Array;return f(e)}function he(){const e=new Error;return f(e)}function Te(e){const t=new Uint8Array(r(e));return f(t)}function Ie(e){const t=r(e).next;return f(t)}function xe(){return z(function(e){const t=r(e).next();return f(t)},arguments)}function ve(e,t,n){r(e)[t>>>0]=l(n)}function ke(e,t,n){r(e)[l(t)]=l(n)}function Ae(e,t,n){r(e).set(r(t),n>>>0)}function Be(e,t){const n=r(t).stack,_=x(n,i.__wbindgen_export_2,i.__wbindgen_export_3),o=p;a().setInt32(e+4*1,o,!0),a().setInt32(e+4*0,_,!0)}function Me(e){const t=r(e).value;return f(t)}function je(e,t,n,_){console.warn(r(e),r(t),r(n),r(_))}function Ue(e){return+r(e)}function Se(e){const t=BigInt.asUintN(64,e);return f(t)}function qe(e,t){const n=r(t),_=typeof n=="bigint"?n:void 0;a().setBigInt64(e+8*1,v(_)?BigInt(0):_,!0),a().setInt32(e+4*0,!v(_),!0)}function Ee(e){const t=r(e);return typeof t=="boolean"?t?1:0:2}function Ge(e,t){const n=E(r(t)),_=x(n,i.__wbindgen_export_2,i.__wbindgen_export_3),o=p;a().setInt32(e+4*1,o,!0),a().setInt32(e+4*0,_,!0)}function ze(e,t){const n=new Error(I(e,t));return f(n)}function Oe(e,t){return r(e) in r(t)}function We(e){return typeof r(e)=="bigint"}function Fe(e){return typeof r(e)=="function"}function Le(e){const t=r(e);return typeof t=="object"&&t!==null}function Ne(e){return r(e)===void 0}function De(e,t){return r(e)===r(t)}function Re(e,t){return r(e)==r(t)}function $e(){const e=i.memory;return f(e)}function Ve(e,t){const n=r(t),_=typeof n=="number"?n:void 0;a().setFloat64(e+8*1,v(_)?0:_,!0),a().setInt32(e+4*0,!v(_),!0)}function Ce(e){return f(e)}function He(e){const t=r(e);return f(t)}function Je(e){l(e)}function Pe(e,t){const n=r(t),_=typeof n=="string"?n:void 0;var o=v(_)?0:x(_,i.__wbindgen_export_2,i.__wbindgen_export_3),c=p;a().setInt32(e+4*1,c,!0),a().setInt32(e+4*0,o,!0)}function Ke(e,t){const n=I(e,t);return f(n)}function Qe(e,t){throw new Error(I(e,t))}URL=globalThis.URL;const w=await R({"./phomo_wasm_bg.js":{__wbindgen_object_drop_ref:Je,__wbg_new_405e22f390576ce2:pe,__wbg_new_78feb108b6472713:ye,__wbindgen_number_new:Ce,__wbindgen_bigint_from_u64:Se,__wbg_set_3f1d0b984ed272ed:ke,__wbg_set_37837023f3d740e8:ve,__wbindgen_error_new:ze,__wbindgen_is_object:Le,__wbg_getwithrefkey_1dc361bd10053bfe:ae,__wbindgen_is_undefined:Ne,__wbindgen_in:Oe,__wbindgen_is_bigint:We,__wbindgen_bigint_get_as_i64:qe,__wbindgen_jsval_eq:De,__wbg_isSafeInteger_343e2beeeece1bb0:ge,__wbindgen_as_number:Ue,__wbindgen_string_new:Ke,__wbg_error_524f506f44df1645:_e,__wbg_length_e2d2a49132c1b256:le,__wbg_get_b9b93047fe3cf45b:se,__wbg_new_a12002a7f91c75be:Te,__wbg_isArray_a1eab7e0d067391b:ue,__wbg_iterator_9a24c88df860dc65:fe,__wbg_get_67b2ba62fc30de12:oe,__wbindgen_is_function:Fe,__wbg_call_672a4d21634d4a24:ee,__wbg_next_25feadfc0913fea9:Ie,__wbg_next_6574e1a8a62d1055:xe,__wbg_done_769e5ede4b31c67b:ne,__wbg_value_cd1ffa7b1ab794f1:Me,__wbg_new_8a6f238a6ece86ea:he,__wbg_stack_0ed75d68575b0f3c:Be,__wbg_error_7534b8e9a36f1ab4:re,__wbg_length_a446193dc22c12f8:we,__wbindgen_memory:$e,__wbg_buffer_609cc3eee51ed158:Z,__wbg_set_65595bdd868b3009:Ae,__wbindgen_jsval_loose_eq:Re,__wbindgen_boolean_get:Ee,__wbindgen_number_get:Ve,__wbindgen_string_get:Pe,__wbg_instanceof_Uint8Array_17156bcf118086a9:de,__wbg_instanceof_ArrayBuffer_e14585432e3737fc:be,__wbindgen_object_clone_ref:He,__wbindgen_throw:Qe,__wbindgen_debug_string:Ge,__wbg_error_80de38b3f7cc3c3c:ie,__wbg_warn_aaf1f4664a035bd6:je,__wbg_info_033d8b8a0838f1d3:ce,__wbg_log_cad59bb680daec67:me,__wbg_debug_e17b51583ca6a632:te}},D),Xe=w.memory,Ye=w.init_panic_hook,Ze=w.overlayGrid,et=w.__wbg_mosaic_free,tt=w.mosaic_new,nt=w.mosaic_equalize,_t=w.mosaic_transferMasterToTiles,rt=w.mosaic_transferTilesToMaster,it=w.mosaic_build,ot=w.mosaic_buildGreedy,st=w.mosaic_getTiles,at=w.mosaic_getMaster,ct=w.mosaic_buildBlueprint,bt=w.mosaic_buildBlueprintGreedy,dt=w.mosaic_renderBlueprint,ut=w.__wbindgen_export_0,gt=w.__wbindgen_export_1,ft=w.__wbindgen_export_2,wt=w.__wbindgen_export_3,lt=w.__wbindgen_add_to_stack_pointer,F=w.__wbindgen_start;var mt=Object.freeze({__proto__:null,__wbg_mosaic_free:et,__wbindgen_add_to_stack_pointer:lt,__wbindgen_export_0:ut,__wbindgen_export_1:gt,__wbindgen_export_2:ft,__wbindgen_export_3:wt,__wbindgen_start:F,init_panic_hook:Ye,memory:Xe,mosaic_build:it,mosaic_buildBlueprint:ct,mosaic_buildBlueprintGreedy:bt,mosaic_buildGreedy:ot,mosaic_equalize:nt,mosaic_getMaster:at,mosaic_getTiles:st,mosaic_new:tt,mosaic_renderBlueprint:dt,mosaic_transferMasterToTiles:_t,mosaic_transferTilesToMaster:rt,overlayGrid:Ze});$(mt);F();const L=async e=>{const _=await (await (await fetch(e)).blob()).arrayBuffer();return new Uint8Array(_)};var S=(e=>(e.None="none",e.MasterToTile="masterToTile",e.TileToMaster="tileToMaster",e.Equalize="equalize",e))(S||{}),G=(e=>(e.Optimal="optimal",e.Greedy="greedy",e))(G||{});const pt=async e=>Promise.all(e.map(t=>L(t)));self.onmessage=async e=>{console.log(e);const{masterImageUrl:t,tileImagesUrls:n,gridWidth:_,gridHeight:o,tileSizingMethod:c,tileRepeats:s,tileAssignmentMethod:b,colorMatchingMethod:u,mosaicImageSize:g}=e.data;console.log(e.data);try{const d=await L(t),y=await pt(n),m=new Y(d,y,_,o,s,c,g?Uint32Array.from(g):void 0);switch(u){case S.MasterToTile:m.transferMasterToTiles();break;case S.TileToMaster:m.transferTilesToMaster();break;case S.Equalize:m.equalize();break}let h;switch(b){case G.Optimal:h=m.buildBlueprint("NormL1");break;case G.Greedy:h=m.buildBlueprintGreedy("NormL1");break}const q=m.renderBlueprint(h);self.postMessage({mosaicTiles:m.getTiles(),mosaicBlueprint:h,mosaicImage:q})}catch(d){let y="An unknown error occurred.";d instanceof Error?y=d.message:typeof d=="string"&&(y=d),self.postMessage({error:y})}}})();