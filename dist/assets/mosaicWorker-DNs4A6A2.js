(async()=>{var L="/phomo-rs/assets/phomo_wasm_bg-B7qa0FVs.wasm",N=async(e={},t)=>{let n;if(t.startsWith("data:")){const _=t.replace(/^data:.*?base64,/,"");let o;if(typeof Buffer=="function"&&typeof Buffer.from=="function")o=Buffer.from(_,"base64");else if(typeof atob=="function"){const c=atob(_);o=new Uint8Array(c.length);for(let s=0;s<c.length;s++)o[s]=c.charCodeAt(s)}else throw new Error("Cannot decode base64-encoded data URL");n=await WebAssembly.instantiate(o,e)}else{const _=await fetch(t),o=_.headers.get("Content-Type")||"";if("instantiateStreaming"in WebAssembly&&o.startsWith("application/wasm"))n=await WebAssembly.instantiateStreaming(_,e);else{const c=await _.arrayBuffer();n=await WebAssembly.instantiate(c,e)}}return n.instance.exports};let i;function $(e){i=e}const p=new Array(128).fill(void 0);p.push(void 0,null,!0,!1);function r(e){return p[e]}let v=p.length;function R(e){e<132||(p[e]=v,v=e)}function l(e){const t=r(e);return R(e),t}const V=typeof TextDecoder>"u"?(0,module.require)("util").TextDecoder:TextDecoder;let W=new V("utf-8",{ignoreBOM:!0,fatal:!0});W.decode();let k=null;function A(){return(k===null||k.byteLength===0)&&(k=new Uint8Array(i.memory.buffer)),k}function h(e,t){return e=e>>>0,W.decode(A().subarray(e,e+t))}function u(e){v===p.length&&p.push(p.length+1);const t=v;return v=p[t],p[t]=e,t}function T(e){return e==null}let x=null;function a(){return(x===null||x.buffer.detached===!0||x.buffer.detached===void 0&&x.buffer!==i.memory.buffer)&&(x=new DataView(i.memory.buffer)),x}let m=0;const C=typeof TextEncoder>"u"?(0,module.require)("util").TextEncoder:TextEncoder;let j=new C("utf-8");const G=typeof j.encodeInto=="function"?function(e,t){return j.encodeInto(e,t)}:function(e,t){const n=j.encode(e);return t.set(n),{read:e.length,written:n.length}};function M(e,t,n){if(n===void 0){const b=j.encode(e),f=t(b.length,1)>>>0;return A().subarray(f,f+b.length).set(b),m=b.length,f}let _=e.length,o=t(_,1)>>>0;const c=A();let s=0;for(;s<_;s++){const b=e.charCodeAt(s);if(b>127)break;c[o+s]=b}if(s!==_){s!==0&&(e=e.slice(s)),o=n(o,_,_=s+e.length*3,1)>>>0;const b=A().subarray(o+s,o+_),f=G(e,b);s+=f.written,o=n(o,_,s,1)>>>0}return m=s,o}function S(e){const t=typeof e;if(t=="number"||t=="boolean"||e==null)return`${e}`;if(t=="string")return`"${e}"`;if(t=="symbol"){const o=e.description;return o==null?"Symbol":`Symbol(${o})`}if(t=="function"){const o=e.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(e)){const o=e.length;let c="[";o>0&&(c+=S(e[0]));for(let s=1;s<o;s++)c+=", "+S(e[s]);return c+="]",c}const n=/\[object ([^\]]+)\]/.exec(toString.call(e));let _;if(n.length>1)_=n[1];else return toString.call(e);if(_=="Object")try{return"Object("+JSON.stringify(e)+")"}catch{return"Object"}return e instanceof Error?`${e.name}: ${e.message}
${e.stack}`:_}function H(e,t){const n=t(e.length*1,1)>>>0;return A().set(e,n/1),m=e.length,n}let B=null;function J(){return(B===null||B.byteLength===0)&&(B=new Uint32Array(i.memory.buffer)),B}function P(e,t){const n=t(e.length*4,4)>>>0;return J().set(e,n/4),m=e.length,n}function K(e,t){e=e>>>0;const n=a(),_=[];for(let o=e;o<e+4*t;o+=4)_.push(l(n.getUint32(o,!0)));return _}function q(e,t){try{return e.apply(this,t)}catch(n){i.__wbindgen_export_3(u(n))}}const E=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>i.__wbg_mosaic_free(e>>>0,1));class Q{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,E.unregister(this),t}free(){const t=this.__destroy_into_raw();i.__wbg_mosaic_free(t,0)}constructor(t,n,_,o,c,s){try{const y=i.__wbindgen_add_to_stack_pointer(-16),F=H(t,i.__wbindgen_export_0),D=m;var b=T(s)?0:P(s,i.__wbindgen_export_0),f=m;i.mosaic_new(y,F,D,u(n),_,o,T(c)?2:c,b,f);var d=a().getInt32(y+4*0,!0),g=a().getInt32(y+4*1,!0),I=a().getInt32(y+4*2,!0);if(I)throw l(g);return this.__wbg_ptr=d>>>0,E.register(this,this.__wbg_ptr,this),this}finally{i.__wbindgen_add_to_stack_pointer(16)}}equalize(){i.mosaic_equalize(this.__wbg_ptr)}transferMasterToTiles(){i.mosaic_transferMasterToTiles(this.__wbg_ptr)}transferTilesToMaster(){try{const _=i.__wbindgen_add_to_stack_pointer(-16);i.mosaic_transferTilesToMaster(_,this.__wbg_ptr);var t=a().getInt32(_+4*0,!0),n=a().getInt32(_+4*1,!0);if(n)throw l(t)}finally{i.__wbindgen_add_to_stack_pointer(16)}}build(t){let n,_;try{const g=i.__wbindgen_add_to_stack_pointer(-16),I=M(t,i.__wbindgen_export_0,i.__wbindgen_export_1),y=m;i.mosaic_build(g,this.__wbg_ptr,I,y);var o=a().getInt32(g+4*0,!0),c=a().getInt32(g+4*1,!0),s=a().getInt32(g+4*2,!0),b=a().getInt32(g+4*3,!0),f=o,d=c;if(b)throw f=0,d=0,l(s);return n=f,_=d,h(f,d)}finally{i.__wbindgen_add_to_stack_pointer(16),i.__wbindgen_export_2(n,_,1)}}getTiles(){try{const s=i.__wbindgen_add_to_stack_pointer(-16);i.mosaic_getTiles(s,this.__wbg_ptr);var t=a().getInt32(s+4*0,!0),n=a().getInt32(s+4*1,!0),_=a().getInt32(s+4*2,!0),o=a().getInt32(s+4*3,!0);if(o)throw l(_);var c=K(t,n).slice();return i.__wbindgen_export_2(t,n*4,4),c}finally{i.__wbindgen_add_to_stack_pointer(16)}}getMaster(){let t,n;try{const d=i.__wbindgen_add_to_stack_pointer(-16);i.mosaic_getMaster(d,this.__wbg_ptr);var _=a().getInt32(d+4*0,!0),o=a().getInt32(d+4*1,!0),c=a().getInt32(d+4*2,!0),s=a().getInt32(d+4*3,!0),b=_,f=o;if(s)throw b=0,f=0,l(c);return t=b,n=f,h(b,f)}finally{i.__wbindgen_add_to_stack_pointer(16),i.__wbindgen_export_2(t,n,1)}}buildBlueprint(t){try{const c=i.__wbindgen_add_to_stack_pointer(-16),s=M(t,i.__wbindgen_export_0,i.__wbindgen_export_1),b=m;i.mosaic_buildBlueprint(c,this.__wbg_ptr,s,b);var n=a().getInt32(c+4*0,!0),_=a().getInt32(c+4*1,!0),o=a().getInt32(c+4*2,!0);if(o)throw l(_);return l(n)}finally{i.__wbindgen_add_to_stack_pointer(16)}}renderBlueprint(t){let n,_;try{const g=i.__wbindgen_add_to_stack_pointer(-16);i.mosaic_renderBlueprint(g,this.__wbg_ptr,u(t));var o=a().getInt32(g+4*0,!0),c=a().getInt32(g+4*1,!0),s=a().getInt32(g+4*2,!0),b=a().getInt32(g+4*3,!0),f=o,d=c;if(b)throw f=0,d=0,l(s);return n=f,_=d,h(f,d)}finally{i.__wbindgen_add_to_stack_pointer(16),i.__wbindgen_export_2(n,_,1)}}}function X(e){l(e)}function Y(e,t){const n=new Error(h(e,t));return u(n)}function Z(e){const t=r(e);return typeof t=="object"&&t!==null}function ee(e,t){const n=r(e)[r(t)];return u(n)}function te(e){return r(e)===void 0}function ne(e,t){return r(e) in r(t)}function _e(e){return typeof r(e)=="bigint"}function re(e,t){const n=r(t),_=typeof n=="bigint"?n:void 0;a().setBigInt64(e+8*1,T(_)?BigInt(0):_,!0),a().setInt32(e+4*0,!T(_),!0)}function oe(e){const t=BigInt.asUintN(64,e);return u(t)}function ie(e,t){return r(e)===r(t)}function se(e){return Number.isSafeInteger(r(e))}function ae(e){return+r(e)}function ce(e,t){const n=h(e,t);return u(n)}function fe(e){console.error(r(e))}function be(e){return r(e).length}function ue(e,t){const n=r(e)[t>>>0];return u(n)}function de(e){const t=new Uint8Array(r(e));return u(t)}function ge(){const e=new Object;return u(e)}function we(){const e=new Array;return u(e)}function le(e){return u(e)}function me(e,t,n){r(e)[l(t)]=l(n)}function pe(e,t,n){r(e)[t>>>0]=l(n)}function ye(e){return Array.isArray(r(e))}function he(){return u(Symbol.iterator)}function Te(){return q(function(e,t){const n=Reflect.get(r(e),r(t));return u(n)},arguments)}function Ie(e){return typeof r(e)=="function"}function xe(){return q(function(e,t){const n=r(e).call(r(t));return u(n)},arguments)}function ve(e){const t=r(e).next;return u(t)}function Ae(){return q(function(e){const t=r(e).next();return u(t)},arguments)}function Me(e){return r(e).done}function ke(e){const t=r(e).value;return u(t)}function Be(){const e=new Error;return u(e)}function je(e,t){const n=r(t).stack,_=M(n,i.__wbindgen_export_0,i.__wbindgen_export_1),o=m;a().setInt32(e+4*1,o,!0),a().setInt32(e+4*0,_,!0)}function Ue(e,t){let n,_;try{n=e,_=t,console.error(h(e,t))}finally{i.__wbindgen_export_2(n,_,1)}}function Se(e){return r(e).length}function qe(){const e=i.memory;return u(e)}function Ee(e){const t=r(e).buffer;return u(t)}function We(e,t,n){r(e).set(r(t),n>>>0)}function ze(e,t){return r(e)==r(t)}function Oe(e){const t=r(e);return typeof t=="boolean"?t?1:0:2}function Fe(e,t){const n=r(t),_=typeof n=="number"?n:void 0;a().setFloat64(e+8*1,T(_)?0:_,!0),a().setInt32(e+4*0,!T(_),!0)}function De(e,t){const n=r(t),_=typeof n=="string"?n:void 0;var o=T(_)?0:M(_,i.__wbindgen_export_0,i.__wbindgen_export_1),c=m;a().setInt32(e+4*1,c,!0),a().setInt32(e+4*0,o,!0)}function Le(e){let t;try{t=r(e) instanceof Uint8Array}catch{t=!1}return t}function Ne(e){let t;try{t=r(e) instanceof ArrayBuffer}catch{t=!1}return t}function $e(e){const t=r(e);return u(t)}function Re(e,t){throw new Error(h(e,t))}function Ve(e,t){const n=S(r(t)),_=M(n,i.__wbindgen_export_0,i.__wbindgen_export_1),o=m;a().setInt32(e+4*1,o,!0),a().setInt32(e+4*0,_,!0)}function Ce(e,t,n,_){console.error(r(e),r(t),r(n),r(_))}function Ge(e,t,n,_){console.warn(r(e),r(t),r(n),r(_))}function He(e,t,n,_){console.info(r(e),r(t),r(n),r(_))}function Je(e,t,n,_){console.log(r(e),r(t),r(n),r(_))}function Pe(e,t,n,_){console.debug(r(e),r(t),r(n),r(_))}URL=globalThis.URL;const w=await N({"./phomo_wasm_bg.js":{__wbindgen_object_drop_ref:X,__wbindgen_error_new:Y,__wbindgen_is_object:Z,__wbg_getwithrefkey_edc2c8960f0f1191:ee,__wbindgen_is_undefined:te,__wbindgen_in:ne,__wbindgen_is_bigint:_e,__wbindgen_bigint_get_as_i64:re,__wbindgen_bigint_from_u64:oe,__wbindgen_jsval_eq:ie,__wbg_isSafeInteger_b9dff570f01a9100:se,__wbindgen_as_number:ae,__wbindgen_string_new:ce,__wbg_error_53abcd6a461f73d8:fe,__wbg_length_f217bbbf7e8e4df4:be,__wbg_get_5419cf6b954aa11d:ue,__wbg_new_fec2611eb9180f95:de,__wbg_new_e69b5f66fda8f13c:ge,__wbg_new_034f913e7636e987:we,__wbindgen_number_new:le,__wbg_set_f975102236d3c502:me,__wbg_set_425e70f7c64ac962:pe,__wbg_isArray_6f3b47f09adb61b5:ye,__wbg_iterator_695d699a44d6234c:he,__wbg_get_ef828680c64da212:Te,__wbindgen_is_function:Ie,__wbg_call_a9ef466721e824f2:xe,__wbg_next_13b477da1eaa3897:ve,__wbg_next_b06e115d1b01e10b:Ae,__wbg_done_983b5ffcaec8c583:Me,__wbg_value_2ab8a198c834c26a:ke,__wbg_new_abda76e883ba8a5f:Be,__wbg_stack_658279fe44541cf6:je,__wbg_error_f851667af71bcfc6:Ue,__wbg_length_9254c4bd3b9f23c4:Se,__wbindgen_memory:qe,__wbg_buffer_ccaed51a635d8a2d:Ee,__wbg_set_ec2fcf81bc573fd9:We,__wbindgen_jsval_loose_eq:ze,__wbindgen_boolean_get:Oe,__wbindgen_number_get:Fe,__wbindgen_string_get:De,__wbg_instanceof_Uint8Array_df0761410414ef36:Le,__wbg_instanceof_ArrayBuffer_74945570b4a62ec7:Ne,__wbindgen_object_clone_ref:$e,__wbindgen_throw:Re,__wbindgen_debug_string:Ve,__wbg_error_4d17c5bb1ca90c94:Ce,__wbg_warn_2e2787d40aad9a81:Ge,__wbg_info_1c7fba7da21072d1:He,__wbg_log_4de37a0274d94769:Je,__wbg_debug_a0b6c2c5ac9a4bfd:Pe}},L),Ke=w.memory,Qe=w.init_panic_hook,Xe=w.overlayGrid,Ye=w.__wbg_mosaic_free,Ze=w.mosaic_new,et=w.mosaic_equalize,tt=w.mosaic_transferMasterToTiles,nt=w.mosaic_transferTilesToMaster,_t=w.mosaic_build,rt=w.mosaic_getTiles,ot=w.mosaic_getMaster,it=w.mosaic_buildBlueprint,st=w.mosaic_renderBlueprint,at=w.__wbindgen_export_0,ct=w.__wbindgen_export_1,ft=w.__wbindgen_add_to_stack_pointer,bt=w.__wbindgen_export_2,ut=w.__wbindgen_export_3,z=w.__wbindgen_start;var dt=Object.freeze({__proto__:null,__wbg_mosaic_free:Ye,__wbindgen_add_to_stack_pointer:ft,__wbindgen_export_0:at,__wbindgen_export_1:ct,__wbindgen_export_2:bt,__wbindgen_export_3:ut,__wbindgen_start:z,init_panic_hook:Qe,memory:Ke,mosaic_build:_t,mosaic_buildBlueprint:it,mosaic_equalize:et,mosaic_getMaster:ot,mosaic_getTiles:rt,mosaic_new:Ze,mosaic_renderBlueprint:st,mosaic_transferMasterToTiles:tt,mosaic_transferTilesToMaster:nt,overlayGrid:Xe});$(dt);z();const O=async e=>{const _=await (await (await fetch(e)).blob()).arrayBuffer();return new Uint8Array(_)};var U=(e=>(e.None="none",e.MasterToTile="masterToTile",e.TileToMaster="tileToMaster",e.Equalize="equalize",e))(U||{});const gt=async e=>Promise.all(e.map(t=>O(t)));self.onmessage=async e=>{console.log(e);const{masterImageUrl:t,tileImagesUrls:n,gridWidth:_,gridHeight:o,tileSizingMethod:c,colorMatchingMethod:s,mosaicImageSize:b}=e.data;console.log(e.data);try{const f=await O(t),d=await gt(n),g=new Q(f,d,_,o,c,b?Uint32Array.from(b):void 0);switch(s){case U.MasterToTile:g.transferMasterToTiles();break;case U.TileToMaster:g.transferTilesToMaster();break;case U.Equalize:g.equalize();break}const I=g.buildBlueprint("NormL1"),y=g.renderBlueprint(I);self.postMessage({mosaicTiles:g.getTiles(),mosaicBlueprint:I,mosaicImage:y})}catch(f){let d="An unknown error occurred.";f instanceof Error?d=f.message:typeof f=="string"&&(d=f),self.postMessage({error:d})}}})();